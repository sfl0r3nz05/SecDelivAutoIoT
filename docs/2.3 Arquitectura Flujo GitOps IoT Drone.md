# Diseño de arquitectura de Flujo GitOps para dispositivos IoT en el contexto de Drone
## Diseño
### Componentes
- Repositorio GitLab: es el repositorio donde se almacenará el código fuente de la aplicación y la configuración.
- GitLab CI/CD: es la herramienta que se encargará de la Integración Continua.
- Raspberry Pi con K3s: es el dispositivo IoT que se encargará de la gestión del cluster de Kubernetes y la ejecución de la infraestructura.
- ArgoCD: es el agente CD que se encarga de la implementación de la aplicación y la configuración de la infraestructura en el cluster de Kubernetes.
- Herramienta de análisis de seguridad: es la herramienta (o las herramientas) que se utilizará para el análisis (o chequeo) de la seguridad del código (por ejemplo, SonarQube).
- GitLab Container Registry: es donde se almacenará la imagen del contenedor.
- Drone.io: es una herramienta para automatizar los flujos de trabajo de build, test y deploy de aplicaciones.

### Flujo de trabajo
1. Los desarrolladores realizan cambios en el código de la aplicación y lo suben al repositorio de GitLab.
2. GitLab CI/CD desencadena la ejecución de los flujos de trabajo definidos en “.gitlab-ci.yml” para el build, test y deploy de la imagen del contenedor en GitLab Container Registry.
3. Drone.io recibe una notificación de GitLab CI/CD sobre la finalización del flujo de trabajo de construcción de la imagen del contenedor en GitLab Container Registry.
4. Drone.io desencadena el flujo de trabajo de implementación de la aplicación y la configuración de la infraestructura en el cluster Kubernetes de la Raspberry Pi y también se encarga de la integración con ArgoCD en el cluster de Kubernetes.
5. ArgoCD detecta una nueva publicación de la imagen en GitLab Container Registry y se encarga de la implementación de la aplicación y la configuración de la infraestructura en el cluster Kubernetes de la Raspberry Pi.
6. ArgoCD ejecuta los chequeos de seguridad (herramientas de análisis de seguridad).
7. Si las pruebas son exitosas, ArgoCD construirá la imagen en el cluster de Kubernetes de la Raspberry Pi.
8. El flujo de trabajo de implementación de Drone.io se completa y se envía una notificación al equipo de desarrollo sobre el estado de la implementación.

### Diseño
<img src="" alt="Diseño arquitectura GitOps IoT Drone">

## Referencias
- Diseño, desarrollo e implementación de una arquitectura GitOps - [dspace.ups.edu.ec](https://dspace.ups.edu.ec/bitstream/123456789/22397/1/UPS-CT009712.pdf)
- GitOps para Azure Kubernetes Service - [learn.microsoft.com](https://learn.microsoft.com/es-es/azure/architecture/example-scenario/gitops-aks/gitops-blueprint-aks)
- Explaining GitOps: How does it work? - [youtube.com](https://www.youtube.com/watch?v=dIaX5IhRqkI&ab_channel=DevOpsJourney)
- GitLab Container Registry - [docs.gitlab.com](https://docs.gitlab.com/ee/user/packages/container_registry/)
